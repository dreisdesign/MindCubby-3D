; Ender 3 V2 - Optimized Start G-code (active)
; Purpose: Improve first-layer adhesion by applying a lower initial Z for priming/skirt
; Date: 2025-11-10
; Notes: Active start G-code used by repository

M140 S{material_bed_temperature} ; Set bed temp (non-blocking)
M104 S{material_print_temperature} ; Set nozzle temp (non-blocking)
M190 S{material_bed_temperature} ; Wait for bed
M109 S{material_print_temperature} ; Wait for nozzle

G92 E0 ; Reset extruder
G28 ; Home all axes
M82 ; Set extruder to absolute mode (required so absolute E moves in priming work)
G90 ; Ensure absolute positioning for XYZ moves
M501 ; Load settings from EEPROM (ensure saved probe offset and settings are active)
; Enable saved BLTouch mesh so skirt/prime use mesh compensation (saved mesh: MRISCOC)
M420 S1 ; Enable mesh from EEPROM
G29 ; Re-probe with BLTouch to get fresh Z offset for this print

G1 Z2.0 F3000 ; Lift Z a little
; --- Off-print purge + wipe to avoid dragging a blob onto the model ---
; Move to a corner/back edge for priming (keeps nozzle work away from the print area)
G1 X10 Y200 F5000.0 ; Move to purge corner (safe edge)
G92 E0 ; Reset extruder to 0 for absolute E moves
G1 Z0.0 F1200.0 ; Lower to Z0 (mesh compensation applies printer Z offset)
; --- AGGRESSIVE MULTI-DIRECTIONAL PRIMING TO CLEAN NOZZLE ---
G1 X150 Y200 Z0.0 F1500.0 E8.000 ; Purge line 1: X direction (aggressive extrusion)
G1 X150 Y205 F1500.0 E8.000 ; Purge line 2: Y direction (knock loose filament)
G1 X10 Y205 Z0.0 F1500.0 E8.000 ; Purge line 3: back in X (multi-directional cleaning)
G1 X10 Y200 Z0.0 F1500.0 E8.000 ; Purge line 4: return in Y (aggressive final pass)
; --- RETRACT & WIPE ---
G1 E3.500 F1800.0 ; Retract 3.5mm to reduce ooze after aggressive priming
G1 Z0.60 F1200.0 ; Lift slightly
G1 X80 Y200 F5000.0 ; Travel to center for final wipe
G1 X80 Y207 Z0.60 F1500.0 E4.500 ; Micro-prime wipe (clean nozzle tip)
G92 E0 ; Reset extruder
G1 Z2.0 F3000 ; Move Z up a bit after priming
G1 X30 Y20 Z2.0 F5000.0 ; Move over to safe print start area

; Notes:
; - The purge happens off to the side (X10..X150 at Y200/205), away from the print area so any blob is not dragged across the model.
; - Extrusion quantities were reduced and a retract + micro-prime sequence added to minimize pickup.
; - G29 re-probes BLTouch to get fresh Z offset each print; if too slow, replace with M420 S1 to use saved mesh.
; - Purge Z is set to Z0.0 so mesh compensation applies the correct first-layer height automatically.

; Ready to start print - printer should now align first layer closer to bed for better adhesion